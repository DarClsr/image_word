# 图文生成小程序项目文档

> 目标：面向普通用户的图文生成小程序，支持多种风格图片生成、可选择不同大模型（文生图/图生图/文案生成），提供清晰的创作流程、模板与导出能力。部署成本优先，适合小团队/个人低成本起步。

## 1. 项目概述
- **核心能力**：输入主题/描述 → 选择风格 → 选择模型 → 生成图片与配套文案 → 预览/编辑 → 导出/分享。
- **目标用户**：自媒体、营销、教育内容创作者、社媒运营人员。
- **关键指标**：生成成功率、单次成本、平均生成时长、日活/转化率、用户复访率。

## 2. 业务范围与功能清单
### 2.1 MVP 功能
- 文生图：基于提示词生成不同风格图片。
- 图生图（可选）：上传图片，按风格重绘。
- 文案生成：标题/摘要/标签/文案建议。
- 模型选择：至少支持 2-3 个模型（如 SDXL、Flux、DALL·E 或国内模型）。
- 风格库：预设风格（国风、赛博、日漫、写实、插画、极简等）。
- 任务队列：排队/状态查询/失败重试。
- 作品管理：历史记录、下载、分享。

### 2.2 进阶功能
- 模板系统：图文模板+提示词组合。
- 参数高级设置：分辨率、采样步数、风格强度、种子等。
- 批量生成：一次生成多图。
- 文案本地化：多语言、平台适配。
- 账号体系/会员：额度包、付费增值。

## 3. 技术架构
### 3.1 总体架构（简化）
- **小程序前端**：微信小程序（UI + 任务创建/预览/管理）。
- **后端 API**：统一网关 + 任务编排 + 计费/配额 + 历史记录。
- **模型调用层**：多模型适配器（SDK/HTTP）。
- **存储与缓存**：对象存储（图片/结果）、Redis（任务状态/队列）。
- **任务队列**：异步任务处理（生成耗时操作）。

```
小程序
  |  HTTPS
后端API(网关/鉴权/任务编排)
  |  调用适配器
模型服务(多模型) ----- 任务队列/缓存 -----> 对象存储
```

### 3.2 多模型适配器设计
- 统一接口：`createImage(prompt, style, params)`、`createText(prompt)`。
- 模型路由：按价格、速度、质量、可用性进行自动选择或用户指定。
- 失败回退：模型不可用时自动切换。

## 4. 技术栈选择
### 4.1 前端（小程序）
- **框架**：原生小程序 + TypeScript（或 Taro/UniApp 二选一）。
- **UI 组件**：Vant Weapp 或 TDesign 小程序。
- **状态管理**：小型项目使用内置状态或轻量 store。

### 4.2 后端
- **语言/框架**：Node.js + NestJS 或 Python + FastAPI。
- **任务队列**：BullMQ（Redis）/ Celery（Python）。
- **数据库**：PostgreSQL（用户、任务、作品）。
- **缓存**：Redis。
- **对象存储**：S3 兼容（腾讯 COS / 阿里 OSS / 七牛云）。

### 4.3 模型服务
- **优先低成本云模型**：
  - **开源推理**：SDXL / Flux（自建或云端）
  - **商用 API**：按量计费（可选备用）
- **策略**：先用云 API 快速上线，规模后再自建 GPU。

## 5. 技术实现方式
### 5.1 关键流程
1. 用户输入主题与风格。
2. 前端生成参数并提交任务。
3. 后端写入任务队列。
4. 任务 worker 调用模型生成图片+文案。
5. 图片存对象存储，结果写数据库。
6. 小程序轮询/推送获取结果。

### 5.2 文生图提示词策略
- 模板化提示词：
  - `主题` + `风格` + `画面元素` + `质量描述` + `负面词`。
- 提供风格提示词库 + 智能扩写（可调用文案模型）。

### 5.3 成本控制方案
- 默认生成低分辨率预览，确认后再生成高清。
- 限制免费用户生成次数与并发。
- 模型路由按价格优先。

## 6. UI 设计要点
### 6.1 关键页面
- 首页：主题输入 + 风格选择 + 模型选择 + 立即生成。
- 风格库：卡片式风格预览。
- 生成中：进度条 + 取消。
- 结果页：图片预览、下载、文案复制、再次生成。
- 我的作品：历史记录、收藏、删除。

### 6.2 设计原则
- **极简**：减少参数暴露，提供高级设置折叠。
- **即时反馈**：每一步明确状态。
- **模板化**：新手快速上手。

### 6.3 线框稿与页面结构（建议）
- **首页**
  - 顶部：Logo + 入口（历史/会员/设置）
  - 输入区：主题输入框 + 提示词补全按钮
  - 风格区：横向卡片滑动（带预览图）
  - 模型区：下拉/卡片选择 + 费用提示
  - 主按钮：立即生成
- **风格库**
  - 分类 Tab：国风/写实/动漫/插画/赛博/极简
  - 风格卡片：预览图 + 风格名 + 适用场景
- **生成中**
  - 进度条 + 剩余时间提示
  - 取消/排队状态
- **结果页**
  - 大图预览 + 3-4 张小图候选
  - 文案区：标题/摘要/标签一键复制
  - 操作区：下载/分享/再次生成/高清生成
- **我的作品**
  - 列表卡片：预览图 + 时间 + 状态
  - 批量管理：删除/导出

### 6.4 视觉与组件规范（可直接交给设计）
- **色板**：主色（强调生成按钮），中性色（背景/分割），警示色（失败/额度不足）。
- **字体**：系统默认字体，标题 16-18px，正文 14-15px。
- **间距**：8pt 网格体系，卡片圆角 12-16px。
- **组件清单**：
  - 输入框（含提示词补全）
  - 风格卡片（封面+标题）
  - 模型选择器（价格/速度标签）
  - 进度条（排队/生成）
  - 图片网格（结果候选）
  - 文案复制块（标题/摘要/标签）
  - 额度/会员卡片

### 6.5 设计交付物
- 线框图（低保真）
- 高保真 UI（主流程页）
- 组件规范（颜色/间距/字体/状态）
- 标注切图（小程序切图规范）

### 6.6 AI 直接设计方案（无需手动制图）
如果你不擅长设计，可由 AI 产出“UI 结构稿 + 视觉风格规范 + 组件清单”，再由开发直接落地小程序页面。

**方式 A：文本驱动（最快）**
- 我直接在文档输出“页面结构树 + 交互说明 + 组件清单 + 视觉规范”。
- 你无需使用任何设计工具，开发按规范实现。

**方式 B：AI 生成高保真图（可选）**
- 由我给出统一的 AI 设计提示词（适用于常见 AI 设计/原型工具）。
- 产出图片稿后，开发按图还原。

**方式 C：自动化生成设计标注（可选）**
- 我输出色板、字体、间距、按钮/卡片样式变量表，直接写入样式文件。

> 结论：你不会设计也没关系，建议采用“方式 A + C”，速度最快、成本最低。

### 6.7 AI 直接设计交付（页面结构稿 + 交互说明 + 视觉规范 + 组件清单）
以下内容可直接交给开发实现，无需额外设计软件。

#### 6.7.1 页面结构稿（信息架构）
**A. 首页（生成入口）**
1. 顶部栏：Logo + 历史/会员/设置入口
2. 输入区：
   - 主题输入框（placeholder：如“冬日城市夜景”）
   - 提示词补全按钮（AI 扩写）
3. 风格区：横向滑动卡片（预览图 + 风格名）
4. 模型区：模型选择器（显示“价格/速度/质量”标签）
5. 高级设置（折叠）：分辨率/比例/数量/强度
6. 主按钮：立即生成

**B. 风格库页**
1. 顶部：分类 Tab（国风/写实/动漫/插画/赛博/极简）
2. 列表：风格卡片网格（封面 + 名称 + 适用场景）

**C. 生成中页**
1. 进度条 + 预计时间
2. 状态提示（排队/生成/失败重试）
3. 操作按钮：取消/后台运行

**D. 结果页**
1. 主图预览（可放大）
2. 候选图网格（3-4 张）
3. 文案区：标题/摘要/标签一键复制
4. 操作区：下载/分享/再次生成/高清生成

**E. 我的作品**
1. 作品卡片（预览图 + 时间 + 状态）
2. 筛选：全部/收藏/失败
3. 批量管理：删除/导出

#### 6.7.2 交互说明（关键流程）
1. 用户输入主题 → 选择风格 → 选择模型 → 点击生成。
2. 生成中页显示排队与进度，可切后台继续生成。
3. 结果页支持“再次生成”与“高清生成”。
4. 文案一键复制，分享生成图文卡片。

#### 6.7.3 视觉规范（开发可直接落地）
- **配色建议**：
  - 主色：#4C6FFF（按钮/高亮）
  - 辅色：#00C2A8（成功/提示）
  - 警示：#FF5A5F（失败/额度不足）
  - 背景：#F7F8FA
  - 文本：#1F2937（主）、#6B7280（次）
- **字体**：系统默认字体；标题 18px/半粗，正文 14-15px。
- **圆角**：卡片 12-16px，按钮 24px。
- **阴影**：轻量阴影（提升卡片层级）。

#### 6.7.4 组件清单（小程序组件映射）
- 输入框（主题/提示词扩写）
- 风格卡片（图 + 标题 + 标签）
- 模型选择器（价格/速度/质量标签）
- 进度条（排队/生成）
- 图片网格（候选图）
- 文案复制块（标题/摘要/标签）
- 额度/会员卡片
- Toast/对话框/Loading

### 6.8 UI 文案规范
- **按钮文案**：简短动词 + 结果导向（如“立即生成”“高清生成”“再次生成”“一键复制”）。
- **占位提示**：示例化、启发式（如“输入主题：春日校园海报”）。
- **状态文案**：描述当前状态 + 引导下一步（如“排队中，预计 30 秒”）。
- **错误文案**：原因 + 解决方式（如“额度不足，请开通会员或稍后再试”）。

### 6.9 空状态与失败状态设计
**空状态**
- 我的作品为空：
  - 文案："还没有作品，先生成一张吧"
  - 按钮："去生成"
- 风格库为空：
  - 文案："暂无该分类风格"
  - 按钮："返回" 或 "切换分类"

**失败状态**
- 生成失败：
  - 文案："生成失败，请重试或切换模型"
  - 按钮："重试" / "切换模型"
- 排队超时：
  - 文案："当前排队较多，可稍后再试"
  - 按钮："稍后再试"
- 额度不足：
  - 文案："额度不足，开通会员后可继续"
  - 按钮："开通会员"

### 6.10 通用交互规则
- 生成按钮在任务提交后进入 loading 并禁用，避免重复提交。
- 生成中页支持“后台运行”，返回首页不影响任务。
- 结果页保留最近 1 次参数，方便快速再生成。
- 统一 Toast 提示（成功/失败/警告）。

## 7. 开发步骤（建议节奏）
1. 需求确认 + 交互原型。
2. 小程序基础页面搭建。
3. 后端接口（任务创建/查询/结果）。
4. 接入 1 个图像模型 + 1 个文本模型。
5. 任务队列与对象存储接入。
6. 作品管理与历史记录。
7. 性能优化与成本控制。
8. 上线与监控。

## 8. 流程总结
- 以 **模板化+风格化** 降低用户使用门槛。
- 以 **多模型适配器** 保证稳定性与成本优化。
- 以 **异步任务+对象存储** 应对耗时生成与高并发。

## 9. 部署环境选择（低成本）
### 9.1 低成本推荐方案
- **后端 API**：轻量云主机 1 台（2C/2G 即可）。
- **Redis**：使用云服务小规格或容器部署。
- **数据库**：云数据库小规格（PostgreSQL）。
- **对象存储**：按量计费，低成本。
- **模型调用**：初期优先云 API，按量计费；后期量大后再考虑自建 GPU。

### 9.2 成本控制建议
- 将高清生成作为付费功能。
- 缓存热门风格模板。
- 限制并发和每日免费额度。

## 10. 风险与对策
- **模型不可用**：多模型切换与自动回退。
- **成本超支**：额度限制 + 高级功能付费。
- **生成质量不稳定**：提示词优化 + 人工审核规则。

---

## 11. 交付清单
- 项目文档（本文件）
- 接口文档（OpenAPI）
- UI 原型（Figma/墨刀）
- 小程序前端代码
- 后端服务代码

---

## 12. 下一步建议
- 如果你确认技术栈与功能范围，我可以继续：
  1) 输出更详细的接口文档
  2) 生成 UI 原型结构稿
  3) 给出数据库表结构
  4) 输出提示词模板库
